getwd()
original_data <- read_csv('data/paper/fulldata_79.csv')
library(tidyverse)
original_data <- read_csv('data/paper/fulldata_79.csv')
getwd()
setwd("/Users/daisypacheco/Documents/GitHub/MLProject")
original_data <- read_csv('data/paper/fulldata_79.csv')
names_dictionary <- read_csv('data/paper/dictionary_79.csv')
cpi <- read_csv('data/paper/CPI.csv')
tidy_data <- original_data %>%
tidyr::pivot_longer(
-c(R0000100, R0214700, R0214800, R0010300),
names_to = "variable_id",
values_to = "value",
values_drop_na = TRUE
) %>%
dplyr::left_join(
names_dictionary
) %>%
dplyr::filter(value >= 0) %>%
dplyr::rename(
id = R0000100,
ethnicity = R0214700,
gender = R0214800,
religion = R0010300
) %>%
dplyr::select(-variable_id, -religion, -ethnicity, -gender)
View(tidy_data)
original_data_97 <- read_csv("data/paper/fulldata_97.csv")
names_dictionary_97 <- read.csv("data/paper/dictionary_97.csv", sep = ";")
tidy_data_97 <- original_data_97 %>%
tidyr::pivot_longer(
-c(R0000100),
names_to = "variable_id",
values_to = "value",
values_drop_na = TRUE
) %>%
dplyr::left_join(
names_dictionary_97
) %>%
dplyr::filter(value >= 0)  %>%
dplyr::rename(
id = R0000100
) %>%
dplyr::select(-variable_id)
View(tidy_data_97)
View(tidy_data)
yearly_variables <- tidy_data %>%
filter(is.na(job_number)) %>%
select(id, year, variable, value) %>%
pivot_wider(
names_from = variable,
values_from = value
) %>%
select(-highest_grade, -urban_rural, -net_family_income,
-military_pay, -sample_id)
yearly_variables_97 <- tidy_data_97 %>%
filter(is.na(job_number)) %>%
select(id, year, variable, value) %>%
pivot_wider(
names_from = variable,
values_from = value
)
View(yearly_variables)
View(yearly_variables_97)
tidy_data_fix <- tidy_data %>%
filter(!is.na(job_number)) %>%
left_join(yearly_variables)
tidy_data_fix_97 <- tidy_data_97 %>%
filter(!is.na(job_number)) %>%
left_join(yearly_variables_97)
?row_number
x <- c(5, 1, 3, 2, 2, NA)
row_number(x)
x
columnar_data <- tidy_data_fix %>%
group_by(id, variable, job_number, year, job_satisfaction_global,
rotter_score, age, rosenberg_score) %>%
mutate(row = row_number())
View(columnar_data)
summary(columnar_data$row)
table(columnar_data$row)
df <- createDataFrame(mtcars)
a <- df %>% mutate(id=row_number()) %>% head(10)
print(a)
columnar_data <- tidy_data_fix %>%
group_by(id, variable, job_number, year, job_satisfaction_global,
rotter_score, age, rosenberg_score)
View(columnar_data)
columnar_data <- tidy_data_fix %>%
group_by(id, variable, job_number, year, job_satisfaction_global,
rotter_score, age, rosenberg_score) %>%
mutate(row = row_number()) %>%
pivot_wider(
names_from = variable,
values_from = value
) %>%
left_join(cpi) %>%
select(-row)
View(columnar_data)
View(tidy_data_fix)
columnar_data_97 <- tidy_data_fix_97 %>%
group_by(id, variable, job_number, year, age) %>%
mutate(row = row_number()) %>%
pivot_wider(
names_from = variable,
values_from = value
) %>%
left_join(cpi)
?ungroup
View(names_dictionary_97)
data_mutations <- columnar_data %>%
mutate(
job_satisfaction =
case_when(
currently_working == 1 & is.na(job_satisfaction) ~ job_satisfaction_global,
currently_working == 0 & is.na(job_satisfaction) ~ NA_real_,
currently_working == NA ~ NA_real_,
TRUE ~ job_satisfaction
)
) %>%
ungroup() %>%
select(-job_satisfaction_global) %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 4 ~ 1,
job_satisfaction == 3 ~ 2,
job_satisfaction == 2 ~ 3,
job_satisfaction == 1 ~ 4,
TRUE ~ job_satisfaction
)
) %>%
mutate(
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = tenure / 52,
avg_age_job_year = ((age - tenure) + age) / 2,
public = case_when(year <= 1993 & sector == 2 ~ 1,
year > 1993 & sector == 1 ~ 1,
TRUE ~ 0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked_week, hourly_pay,
rotter_score, rosenberg_score)
View(data_mutations)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = (stop_date - start_date) / 365,
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction))
View(data_mutations_97)
View(names_dictionary)
View(names_dictionary_97)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = (stop_date - start_date) / 365,
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked, hourly_pay)
View(data_mutations_97)
summary(data_mutations_97)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = as.numeric((stop_date - start_date) / 365),
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked, hourly_pay)
View(columnar_data)
View(data_mutations_97)
summary(data_mutations_97)
imputed_data <- data_mutations %>%
group_by(id) %>%
mutate(rosenberg_score = na.approx(rosenberg_score, na.rm = FALSE)) %>%
mutate(rosenberg_score = ifelse(is.na(rosenberg_score),
mean(rosenberg_score, na.rm = T),
rosenberg_score)) %>%
mutate(rotter_score = na.approx(rotter_score, na.rm = FALSE)) %>%
mutate(rotter_score = ifelse(is.na(rotter_score),
mean(rotter_score, na.rm = T),
rotter_score)) %>%
mutate(tenure = ifelse(is.na(tenure),
mean(tenure, na.rm = T),
tenure)) %>%
mutate(hours_worked_week = ifelse(is.na(hours_worked_week),
mean(hours_worked_week, na.rm = T),
hours_worked_week)) %>%
mutate(hourly_pay = ifelse(is.na(hourly_pay),
mean(hourly_pay, na.rm = T),
hourly_pay)) %>%
ungroup()
# imputation
## linear interpolation for values measured at least twice
## otherwise, mean imputation
library(zoo)
imputed_data <- data_mutations %>%
group_by(id) %>%
mutate(rosenberg_score = na.approx(rosenberg_score, na.rm = FALSE)) %>%
mutate(rosenberg_score = ifelse(is.na(rosenberg_score),
mean(rosenberg_score, na.rm = T),
rosenberg_score)) %>%
mutate(rotter_score = na.approx(rotter_score, na.rm = FALSE)) %>%
mutate(rotter_score = ifelse(is.na(rotter_score),
mean(rotter_score, na.rm = T),
rotter_score)) %>%
mutate(tenure = ifelse(is.na(tenure),
mean(tenure, na.rm = T),
tenure)) %>%
mutate(hours_worked_week = ifelse(is.na(hours_worked_week),
mean(hours_worked_week, na.rm = T),
hours_worked_week)) %>%
mutate(hourly_pay = ifelse(is.na(hourly_pay),
mean(hourly_pay, na.rm = T),
hourly_pay)) %>%
ungroup()
imputed_data_97 <- data_mutations_97 %>%
group_by(id) %>%
mutate(tenure = ifelse(is.na(tenure),
mean(tenure, na.rm = T),
tenure)) %>%
mutate(hours_worked = ifelse(is.na(hours_worked),
mean(hours_worked, na.rm = T),
hours_worked)) %>%
mutate(hourly_pay = ifelse(is.na(hourly_pay),
mean(hourly_pay, na.rm = T),
hourly_pay)) %>%
ungroup()
imputed_data_final_97 <- imputed_data_97 %>%
filter(hours_worked >= 35)
imputed_data_final <- imputed_data %>%
filter(hours_worked_week >= 35)
View(columnar_data_97)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
unique_employer_id = paste0(id, "_", employer_id),
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = as.numeric((stop_date - start_date) / 365),
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked, hourly_pay)
View(data_mutations_97)
View(data_mutations_97)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
unique_employer_id = paste0(id, "_", employer_id),
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = as.numeric((stop_date - start_date) / 365),
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked, hourly_pay)
View(data_mutations_97)
data_mutations_97 <- columnar_data_97 %>%
mutate(
job_satisfaction = dplyr::case_when(
job_satisfaction == 5 ~ 1,
job_satisfaction == 4 ~ 2,
job_satisfaction == 3 ~ 3,
job_satisfaction == 2 ~ 4,
job_satisfaction == 1 ~ 5,
TRUE ~ job_satisfaction
)
) %>%
mutate(
unique_employer_id = paste0(id, "_", employer_id),
start_date = as.Date(paste0("1", "/", start_month, "/", start_year), format("%d/%m/%Y")),
stop_date = as.Date(paste0("1", "/", stop_month, "/", stop_year), format("%d/%m/%Y")),
hourly_pay = log((hourly_pay * cpi) + 1),
tenure = as.numeric((stop_date - start_date) / 365),
avg_age_job_year = ((age - tenure) + age) / 2,
public = ifelse(industry == 1, 1,0)
) %>%
filter(public == 1 &
!is.na(employer_id) &
!is.na(job_satisfaction)) %>%
select(id, year, job_number, employer_id,
job_satisfaction,
age, avg_age_job_year, tenure,
hours_worked, hourly_pay, unique_employer_id)
View(data_mutations_97)
table(columnar_data$year)
table(columnar_data_97$year)
cpi <- read_csv('data/paper/CPI.csv')
View(cpi)

---
title: "Marginal Probability Plots"
author: "Marina Wyss & Daisy Pacheco"
date: "12/20/2022"
output: html_document
---

```{r setup, include=FALSE}
library(GLMMadaptive)
library(lattice)
library(dplyr)

full_glmm_interact <- readRDS("trained_models/full_glmm_interact.rds")

load("data/full_prepped_data.RData")

prepped_data$job_satisfaction = as.factor(prepped_data$job_satisfaction)

# filtering for full time
full_time_data <- prepped_data %>% 
  filter(hours_worked_week >= 35) %>% 
  select(-full_time)
```


```{r}
# prep plot data
# take a sample since memory is exhausted otherwise
# sample_data <- full_time_data[sample(nrow(full_time_data), 1000), ]

# plot_data <- effectPlotData(full_glmm_interact,
#                             sample_data,
#                             direction = "forward",
#                             marginal = TRUE)
# saveRDS(plot_data, "data/marginal_prob_plot_data.rds")
plot_data <- readRDS("data/marginal_prob_plot_data.rds")

# plot
xyplot(pred ~ avg_age_per_job_centered,
       data = plot_data, 
       group = public,
       type = c("p", "smooth"),
       auto.key = TRUE,
       xlab = "Tenure (Centered)",
       ylab = "Marginal Probabilities\nalso w.r.t Random Effects",
       main = "Marginal Probability Plot for Public (1) and Private (0) Sector Employees"
)

xyplot(pred ~ tenure_centered,
       data = plot_data, 
       group = public,
       type = c("p", "smooth"),
       auto.key = TRUE,
       xlab = "Tenure (Centered)",
       ylab = "Marginal Probabilities\nalso w.r.t Random Effects",
       main = "Marginal Probability Plot for Public (1) and Private (0) Sector Employees"
)

xyplot(pred ~ avg_age_per_job_centered | public,
       data = plot_data, 
       group = job_satisfaction,
       upper = plot_data$upp,
       low = plot_data$low, 
       type = "p",
       xlab = "Average Age in a Given Job (Centered)",
       ylab = "Marginal Probabilities\nalso w.r.t Random Effects"
)

xyplot(pred ~ tenure_centered | public,
       data = plot_data, 
       group = job_satisfaction,
       upper = plot_data$upp,
       low = plot_data$low, 
       type = "p",
       xlab = "Tenure (Centered)",
       ylab = "Marginal Probabilities\nalso w.r.t Random Effects"
)
```

